syntax = "proto3";

package dss;

// dss_heartbeat 메시지 정의
message DssHeartbeat {
    string identifier = 2;
    int64 timestamp   = 3;         // 타임스탬프 (밀리초 단위, 옵션)
    double throttle   = 7;
    double brake      = 8;
    double steer      = 9;
    double parkBrake  = 10;
    double targetGear = 11;
    bool headLight    = 12;
    bool tailLight    = 13;
    int32 turnSignal    = 14;
    bool horn         = 15;
    int32 lightMode     = 16;
    int32 wiperMode     = 17;
}

message DssSetControl {
    string identifier = 2;
    int64 timestamp   = 3;         // 타임스탬프 (밀리초 단위, 옵션)
    double throttle   = 7;
    double brake      = 8;
    double steer      = 9;
    double parkBrake  = 10;
    double targetGear = 11;
    bool headLight    = 12;
    bool tailLight    = 13;
    int32 turnSignal  = 14;
    bool horn         = 15;
    int32 lightMode   = 16;
    int32 wiperMode   = 17;
}


message DssDepthVizPixel {
  int32 u = 1;                 // 픽셀의 u 좌표
  int32 v = 2;                 // 픽셀의 v 좌표
  float vehicle_x = 3;          // 차량 기준 x 좌표
  float vehicle_y = 4;          // 차량 기준 y 좌표
  float vehicle_z = 5;          // 차량 기준 z 좌표
}

message DssDepthVizMessage {
  repeated DssDepthVizPixel pixels = 1; // 샘플링된 DepthViz 픽셀 리스트
}

message DSSHeader {
  double stamp = 1;       // Timestamp (seconds)
  string frame_id = 2;    // Frame name (e.g., "imu_link")
}

message DSSVector3 {
  double x = 1;
  double y = 2;
  double z = 3;
}

message DSSQuaternion {
  double x = 1;
  double y = 2;
  double z = 3;
  double w = 4;
}

// Image 메시지
message DSSImage {
  DSSHeader header = 1;

  uint32 height = 2;         // image height (rows)
  uint32 width = 3;          // image width (columns)
  string encoding = 4;       // e.g., "rgb8", "bgr8", "mono8", "jpeg"
  uint32 is_bigendian = 5;   // 0 = little endian, 1 = big endian
  uint32 step = 6;           // full row length in bytes
  bytes data = 7;            // image data (flattened, row-major)
}



message DSSGPSStatus {
  int32 status = 1;         // -1=no fix, 0=fix, 1=SBAS fix, 2=GBAS fix
  uint32 service = 2;       // bitmask: 1=GPS, 2=GLONASS, 4=COMPASS, 8=GALILEO
}

message DSSGPS {
  DSSHeader header = 1;
  DSSGPSStatus status = 2;

  double latitude = 3;      // degrees
  double longitude = 4;     // degrees
  double altitude = 5;      // meters above mean sea level

  repeated double position_covariance = 6; // 3x3 matrix as row-major [9 elements]
  uint32 position_covariance_type = 7;     // 0=UNKNOWN, 1=APPROX, 2=DIAGONAL, 3=KNOWN

  string source = 8;        // e.g., "simulated", "real", etc. (optional)
}


message DSSIMU {
  DSSHeader header = 1;

  DSSQuaternion orientation = 2;
  repeated double orientation_covariance = 3; // 3x3 row-major (9 values)

  DSSVector3 angular_velocity = 4;
  repeated double angular_velocity_covariance = 5;

  DSSVector3 linear_acceleration = 6;
  repeated double linear_acceleration_covariance = 7;
}


message DSSPose {
  DSSVector3 position = 1;
  DSSQuaternion orientation = 2;
}

message DSSTwist {
  DSSVector3 linear = 1;
  DSSVector3 angular = 2;
}


message DSSOdom {
  DSSHeader header = 1;
  string child_frame_id = 2;

  DSSPose pose = 3;
  repeated double pose_covariance = 4;

  DSSTwist twist = 5;
  repeated double twist_covariance = 6;
}



// 개별 필드 정보 (x, y, z, intensity 등)
message DssPointField {
  string name = 1;           // 필드 이름 (e.g., "x", "y", "z", "intensity")
  uint32 offset = 2;         // 필드 시작 바이트 오프셋
  uint32 datatype = 3;       // 예: 7 (float32)
  uint32 count = 4;          // 필드당 요소 수
}

// 실제 포인트 클라우드 메시지
message DssLidarPointCloud {
  DSSHeader header = 1;

  //string frame_id = 2;        // 센서 좌표계 (ROS 기준)
  //int64 timestamp = 3;        // UNIX 시간 (nanosecond 권장)


  uint32 width = 4;           // 포인트 수 (Unorganized면 총 개수)
  uint32 height = 5;          // 1 for unorganized

  uint32 point_step = 6;      // 포인트당 바이트 수 (e.g., 16 for x,y,z,intensity)
  uint32 row_step = 7;        // row당 바이트 수 (width * point_step)

  bool is_dense = 8;          // 유효하지 않은 포인트 포함 여부
  bool is_bigendian = 9;      // ROS에서 big endian 여부

  repeated DssPointField fields = 10;  // 필드 정보 (x/y/z/intensity 등)

  bytes data = 11;            // packed binary: [x, y, z, intensity] * N
}

// 차량 휠 상태 스냅샷
message FDssWheelSnapshot {
  float suspension_offset = 1;       // 서스펜션 위치 오프셋
  float wheel_rotation_angle = 2;    // 휠 회전 각도
  float steering_angle = 3;          // 조향각  
  float wheel_radius = 4;            // 휠 반지름 (동적으로 변할 수 있음)
  float wheel_angular_velocity = 5;  // 휠 회전 속도 (rad/s)
}

// Ego 차량 상태 스냅샷
message DssEgoVehicleSnapshot {
  float speed_ms  = 1;                // 속도 (m/s)
  float speed_kph = 2;               // 속도 (km/h)
  
  float steer     = 3; 				// -1.0 ~ +1.0
  float throttle  = 4; 				//  0.0 ~ 1.0
  float brake     = 5; 				//  0.0 ~ 1.0

  DSSVector3 linear_velocity = 6;    // 선속도 (m/s)
  DSSVector3 angular_velocity = 7;   // 각속도 
  int32 selected_gear = 8;           // 기어 상태 (-: 후진, 0: 중립, +: 전진)
  float engine_rpm = 9;              // 엔진 RPM
  repeated FDssWheelSnapshot wheel_snapshots = 10; // 각 휠 상태 정보
}


message DssOneFrameFixedRateResult {
 // Unreal: float CustomDeltaTime
  float  custom_delta_time  = 1;

  // Unreal: int64 FrameCount
  int64  frame_count        = 2;

  // Unreal: double TotalElapsedTime
  double total_elapsed_time = 3;
}



message Dss {
  float  custom_delta_time  = 1;
  int64  frame_count        = 2;
  double total_elapsed_time = 3;
}















